#N canvas 342 50 1574 1022 10;
#N canvas 4 50 450 278 (subpatch) 0;
#X array \$1-array 88200 float 2;
#X coords 0 1 88200 -1 335 251 1 0 0;
#X restore 725 59 graph;
#X obj 1007 860 soundfiler;
#X obj 1007 714 symbol \$1-array;
#X obj 1007 804 list prepend read;
#X obj 1007 832 list trim;
#X obj 1007 661 loadbang;
#X text 1118 125 construct the read message using the sound file name
(\$1);
#X obj 1007 736 list;
#X obj 224 131 stripnote;
#X obj 224 218 % 24;
#X obj 224 192 abs;
#X text 300 259 second argument (key number);
#X text 452 24 loads and plays sound file;
#X text 453 46 argument 1: soundfile to load;
#X obj 224 153 expr if ($f1 > 59 \, $f1 - 60 \, $f1 - 12);
#X text 336 177 allow all midi notes to trigger samples...;
#X obj 393 493 r~ inL;
#X obj 463 492 r~ inR;
#X obj 655 935 tabwrite~ \$1-array;
#X obj 533 914 s \$1-array;
#X msg 533 879 normalize 1;
#X obj 465 387 spigot 0;
#X msg 554 491 0;
#X text 629 606 the threshold is hardcoded at .01...;
#X obj 469 611 threshold~ 0.01 1200;
#X text 283 843 normalize and save when done;
#X obj 959 525 symbol \$1-array;
#X obj 960 634 list trim;
#X obj 959 547 list;
#X obj 959 606 list prepend write;
#X obj 542 223 r route-key-rec-select;
#X obj 627 536 s rec-state;
#X msg 627 515 2;
#X obj 469 666 spigot 0;
#X text 604 448 sate = key enabled \, waiting for sound;
#X obj 419 781 s rec-state;
#X msg 419 754 3;
#X msg 488 633 1;
#X obj 288 594 r disable-key-rec-trigger;
#X text 569 684 delay a few ms to get begin of sound;
#X text 165 668 set state = recording;
#X text 164 691 then after 1 second set state = finishing;
#X text 168 715 then after 250 ms sate = done;
#X text 152 948 normalize and saving happen async \, so we just wait
250 ms;
#X msg 429 631 0;
#X text 586 377 record states are 0=play mode \, 1=select key \, 2=wait
for trig \, 3= recording \, 4=finishing up;
#X obj 499 566 *~ 1;
#X obj 766 538 s slot-choice;
#X obj 468 413 t b b b b, f 26;
#X obj 959 497 r saveState;
#X obj 788 787 s rec-state;
#X msg 788 761 0;
#X obj 958 576 list prepend Sounds/\$1.wav;
#X obj 1007 767 list prepend Sounds/\$1.wav;
#X obj 292 192 loadbang;
#X obj 292 214 f \$1;
#X obj 292 236 - 1;
#X obj 219 252 sel;
#X obj 766 510 f \$1;
#X obj 469 697 t b b b b b, f 19;
#X msg 673 730 stop, f 5;
#X msg 655 858 stop;
#X obj 393 515 *~ 0.707;
#X obj 463 514 *~ 0.707;
#X obj 652 760 del 990;
#X msg 716 836 0 10;
#X obj 671 901 *~;
#X obj 819 875 vline~;
#X obj 813 905 *~;
#X obj 652 708 t b b b, f 11;
#X obj 652 832 t b b b;
#X obj 652 782 t b b;
#X obj 652 804 del 10;
#X obj 181 57 r notes;
#X msg 728 738 1 10;
#X obj 564 645 delwrite~ \$1-del 10, f 24;
#X obj 671 879 delread~ \$1-del 10;
#X obj 1169 174 r global-max-duration;
#X obj 1169 226 pack 0 \$1;
#X obj 1169 196 * 44.1;
#X obj 778 710 r global-max-duration;
#X obj 778 732 - 10;
#X msg 1170 247 \; \$2-array resize \$1;
#X connect 2 0 7 0;
#X connect 3 0 4 0;
#X connect 4 0 1 0;
#X connect 5 0 2 0;
#X connect 7 0 53 0;
#X connect 8 0 14 0;
#X connect 9 0 57 0;
#X connect 10 0 9 0;
#X connect 14 0 10 0;
#X connect 16 0 62 0;
#X connect 17 0 63 0;
#X connect 20 0 19 0;
#X connect 21 0 48 0;
#X connect 22 0 24 1;
#X connect 24 0 33 0;
#X connect 26 0 28 0;
#X connect 27 0 1 0;
#X connect 28 0 52 0;
#X connect 29 0 27 0;
#X connect 30 0 21 1;
#X connect 32 0 31 0;
#X connect 33 0 59 0;
#X connect 36 0 35 0;
#X connect 37 0 33 1;
#X connect 38 0 44 0;
#X connect 44 0 33 1;
#X connect 46 0 24 0;
#X connect 46 0 75 0;
#X connect 48 0 37 0;
#X connect 48 1 22 0;
#X connect 48 2 32 0;
#X connect 48 3 58 0;
#X connect 49 0 26 0;
#X connect 51 0 50 0;
#X connect 52 0 29 0;
#X connect 53 0 3 0;
#X connect 54 0 55 0;
#X connect 55 0 56 0;
#X connect 56 0 57 1;
#X connect 57 0 21 0;
#X connect 58 0 47 0;
#X connect 59 1 36 0;
#X connect 59 3 18 0;
#X connect 59 4 69 0;
#X connect 60 0 64 0;
#X connect 60 0 72 0;
#X connect 61 0 18 0;
#X connect 62 0 46 0;
#X connect 63 0 46 0;
#X connect 64 0 71 0;
#X connect 65 0 67 0;
#X connect 66 0 18 0;
#X connect 67 0 68 0;
#X connect 67 0 68 1;
#X connect 68 0 66 1;
#X connect 69 0 64 0;
#X connect 69 1 60 0;
#X connect 69 2 74 0;
#X connect 70 0 20 0;
#X connect 70 1 61 0;
#X connect 70 2 51 0;
#X connect 71 0 72 0;
#X connect 71 1 65 0;
#X connect 72 0 70 0;
#X connect 73 0 8 0;
#X connect 74 0 67 0;
#X connect 76 0 66 0;
#X connect 77 0 79 0;
#X connect 78 0 82 0;
#X connect 79 0 78 0;
#X connect 80 0 81 0;
#X connect 81 0 64 1;
